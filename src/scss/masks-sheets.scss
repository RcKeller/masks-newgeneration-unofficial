:root {
  --actor-gradient: linear-gradient(
    to bottom,
    #58a4fc 0%,
    #b0c2b8 80%,
    #fff1b6 100%
  );
  --masks-primary-text-color: #ffffff;
  --masks-secondary-text-color: #000000;
  --masks-title-text-color: #173f6e;
  --masks-input-text-color: #000000;
  --masks-input-placeholder-color: #979797;
  --masks-input-disabled-color: #0e2949;

  --masks-interactive-bg-color: #1e528f;
  --masks-interactive-bg-hover-color: #173f6e;
  --masks-option-bg-color: #683b47;

  --masks-tabs-border-color: #ffeb98;
  --masks-tab-bg-active-color: #ffeb98;

  --masks-input-bg-color: rgb(255 255 255 / 75%);
  --masks-input-border-color: rgb(0 0 0 / 75%);
  --masks-tox-edit-area-bg-color: rgba(255, 255, 255, 0.5);

  --masks-resource-border-color: #bcc8de;
  --masks-resource-control-bg-color: #ffffff;
  --masks-stats-border-color: rgb(229 222 210 / 37%);

  --masks-cell-title-border-color: #173f6e;
  --masks-header-bg-color: #173f6e;

  --masks-window-bg-image: url("/modules/masks-newgeneration-unofficial/images/skyline.webp"),
    var(--actor-gradient);
  --masks-window-bg-position: bottom left;
  --masks-influence-icon-color: invert(100%);
  --masks-influence-icon-disabled-color: invert(100%) opacity(50%);


  --masks-turncards-card-base: #bda78a;
  --masks-turncards-primary-bg: #f4e7d7;
  --masks-turncards-secondary-bg: #ead0b0;
  --masks-turncards-active-bg: #d1a06e;
  --masks-turncards-action-bg: #87b07e;
  --masks-turncards-cooldown-bar: #3f8aa0;
  --masks-turncards-potential-fill-color: #e7a345;
  --masks-turncards-pentagon-color: #37372b;
  --masks-turncards-cooldown-opacity: 0.75;
}

.pbta.window-app {

  .window-content {
    color: var(--masks-secondary-text-color);
    padding: 0;

    a.content-link, a.inline-roll {
      color: var(--masks-input-text-color);
    }
  }

  input, 
  button, 
  select, 
  textarea {
    background: var(--masks-input-bg-color);
    color: var(--masks-input-text-color);
    border: 0.5px solid var(--masks-input-border-color);
    accent-color: var(--masks-tab-bg-active-color);
    font-weight: bold;
  }

  input:disabled, 
  button:disabled, 
  select:disabled, 
  textarea:disabled {
    background: rgba(153,153,153,.2509803922);
    color: var(--masks-input-disabled-color);
  }

  input::placeholder {
    color: var(--masks-input-placeholder-color) !important;
  }
}

.pbta.sheet {
  
  .advancement {
    display: none;
  }

  .sheet-header__fields .adv-tab {
    display: none;
  }

  .cell__title.warning {
    background-color: #d68888;
    color: #000000;

    &::before {
      height: 0px;
      background-color: none;
    }

    &::after {
      width: 0px;
      background-color: none;
    }
  }

  .cell--influences,
  .cell--relationshipQuestions,
  .cell--adv-tab,
  .cell--advancements,
  .cell--later-advances {
    margin-top: 10px;
  }

  .cell--momentOfTruth label div.moment-unlock {
    font-style: italic;
    text-transform: capitalize;
    font-size: 15px;
    display: flex;
    align-items: center;
  }

  .sheet-header, .sheet-body {
    padding-left: 10px;
    padding-right: 10px;
  }

  .sheet-look .cell--influence { display: none; }
  .sheet-main .cell--equipment { display: none; }

  input::placeholder, 
  .sheet-header select.charplaybook:has(option[value=""]:checked), 
  .sheet-header select.charplaybook option[value=""] {
    color: var(--masks-input-placeholder-color);
    font-style: italic;
  }

  &.item {
    input[type=checkbox], input[type=radio] {
      vertical-align: middle;
      position: relative;
      bottom: 1px;
      height: 15px;
    }
    label {
      color: var(--masks-secondary-text-color);
    }
  }

  .cell--image {
    border: 1px solid var(--masks-cell-title-border-color);

    /* Labels Graph visualization below profile image */
    .labels-graph-container {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 10px;
      padding: 4px;
      cursor: help;

      .labels-graph-svg {
        width: 80px;
        height: 80px;
        display: block;
      }
    }
  }

  .window-header {
    background-color: var(--masks-interactive-bg-color);
  }

  .sheet-resources {
    align-items: start;

    .cell {
      text-align: left;
    }

    .cell>.cell__title {
      justify-content: start;
    }

    .cell--ongoing .resource-control, 
    .cell--forward .resource-control, 
    .cell--roll-formula .resource-control {
      border: 0.5px solid var(--masks-input-border-color);
      background: var(--masks-resource-control-bg-color);
    }
  }
  
  .cell__checkboxes, 
  .cell__radio {
    margin: 0;

    & label.flexrow{
      margin: 0 0 5px 0;
    }
  }

  .window-content {
    background-image: var(--masks-window-bg-image);
    background-position: var(--masks-window-bg-position);
    background-repeat: repeat-x;
    background-size: auto;
  }

  .tox.tox-tinymce .tox-edit-area__iframe {
    background: var(--masks-tox-edit-area-bg-color);
  }

  .sheet-header__fields {
    width: 100%;
  }

  .cell--influences {
    .cell__title .item-group-label {
      cursor: pointer;
    }
    
    .item-details-toggle {
      display: inline-block;
      width: 24px;
      height: 16px;
      text-align: center;
      border-radius: 5px;
      transition: all ease-in-out 0.25s;
    }
  
    .fas {
      transition: all ease-in-out 0.25s;
    }
  
    .open .fas {
      transform: rotate(180deg);
    }
  }

  .editor-content {
    background: var(--masks-input-bg-color);
    color: var(--masks-input-text-color);
    border: 0.5px solid var(--masks-input-border-color);
    min-height: 31px;
    padding: 5px;

    a.content-link, a.inline-roll {
      background: var(--masks-input-bg-color);
      border: 0.5px solid var(--masks-input-border-color);
    }
  }

  .sheet-wrapper {

    .sheet-bottom {
      padding: 0px 10px;
    }

    .sheet-top .sheet-attributes-top {
      padding: 10px;
    }

    .sheet-top .sheet-attributes-top .cell--attributes-top>.cell+.cell::before {
      left: 0;
      width: 0;
      background: none;
    }
    
    .sheet-header {
      background-color: var(--masks-header-bg-color);
    }

    .editor-content {
      background: var(--masks-input-bg-color);
      color: var(--masks-secondary-text-color);
      border: 0.5px solid var(--masks-input-border-color);
      color: var(--masks-input-text-color);
      min-height: 31px;
      padding: 0 10px;
    }

    .sheet-bottom {
      .cell--LongText, 
      .cell--ListMany, 
      .cell--moves,
      .cell--xp,
      .cell--Text,
      .cell--Checkbox,
      .cell--Number {
        padding-top: 5px;
      }

      .cell--conditions {
        padding-top: 0px;
      }
      
      .description {
        .sheet-tab {
          display: flex;
          flex-flow: row wrap;
          justify-content: space-between;
          align-content: flex-start;
          gap: 10px;
        }

        .cell.cell--bio {
          min-height: 175px;
          margin-bottom: 5px;
          width: 48%;

          &:nth-child(3), 
          &:nth-child(4) {
            width: 100%;
          }
    
          .editor {
            min-height: calc(100% - 40px);
    
            .editor-content {
              height: 145px;
            }
          }
        }
      }
    }
  }

  .cell__wrapper {
    position: relative;
    width: 100%;
    
    & > input[type="number"] {
      font-size: 18px;
      text-align: center;
      background-color: var(--masks-input-bg-color);
      color: var(--masks-input-text-color);
      font-weight: bold;
      margin: 0;
      display: block;
      width: 100%;
    }
  }

  .cell--influences {
    .influence-name {
      flex: 2;
      display: flex;
      gap: 2px;
    }

    input.influence--name {
      width: calc(100% - 36px);
      font-size: 18px;
      text-align: left;
      height: 32px;
      margin: 0px 0px 8px 0px;
    }

    .influence-management {
      margin: 0px 0px 8px 0px;
      display: flex;
      flex-direction: row;
      text-align: center;
      flex: 1;

      .influence-disabled {
        filter: var(--masks-influence-icon-disabled-color);
      }
    }
    
    img.influence-icon {
      flex: 1;
      vertical-align: top;
      border: 0;
      height: 32px;
      width: 32px;
      padding: 0;
      margin: 0;
      border-radius: 0;
      filter: var(--masks-influence-icon-color);
    }
  }

  & .cell--influences .influence-management .influence-control.influence-delete,
  & .cell--influences .influence-management .influence-control.influence-lock,
  & .cell--influences .influence-management .influence-control.influence-unlock {
    font-size: 32px;
    flex: 1;
  }

  /* -- */

  .sheet-attributes {
    position: relative;
    padding-top: 8px;
    padding-left: 8px;
    padding-right: 8px;
  
    .cell--stats .stat {
      background: var(--masks-interactive-bg-color);
      color: var(--masks-primary-text-color);
    
      .cell__title {
        color: var(--masks-primary-text-color);
      }

      &:hover {
        background: var(--masks-interactive-bg-hover-color);
      }

      .stat-value {
        border: 1px solid var(--masks-stats-border-color);
      }
    }
  }
  
  .bio_style {
    font-style: italic;
    position: relative;
    padding-left: 8px;
    border-bottom: none;
    color: var(--masks-secondary-text-color);
    letter-spacing: 0.05rem;
    font-size: 22px;
    font-weight: normal;
    margin: 10px 10px 0px 0px;

    &::before {
      /* z-index: -1; */
      content: "";
      position: absolute;
      left: 7px;
      top: 0;
      height: 2px;
      width: calc(100% - 10px);
      background-color: var(--masks-bio-title-border-color);
      transform: skewX(-15deg);
    }

    &::after {
      /* z-index: -1; */
      content: "";
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 4px;
      background-color: var(--masks-bio-title-border-color);
      transform: skewX(-15deg);
    }
  }

  .cell__title {
    font-style: italic;
    font-weight: bold;
    text-transform: uppercase;
    position: relative;
    padding-left: 8px;
    border-bottom: none;
    color: var(--masks-title-text-color);
    letter-spacing: 0.05rem;
    font-size: 22px;

    &::before {
      content: "";
      position: absolute;
      left: 7px;
      top: 0;
      height: 2px;
      width: calc(100% - 10px);
      background-color: var(--masks-cell-title-border-color);
      transform: skewX(-15deg);
    }

    &::after {
      content: "";
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 4px;
      background-color: var(--masks-cell-title-border-color);
      transform: skewX(-15deg);
    }
  }

  .tabs {
    border-bottom: 2px solid var(--masks-tabs-border-color);
  }

  .sheet-tabs.tabs > a.item {
    border-top-left-radius: 5px;
    border-top-right-radius: 5px;
    font-style: italic;
    background-color: var(--masks-interactive-bg-color);
    color: var(--masks-primary-text-color);

    &.active,
    &.active:hover {
      background-color: var(--masks-tab-bg-active-color);
      color: var(--masks-secondary-text-color);
    }

    &:hover,
    &:focus {
      background-color: var(--masks-interactive-bg-hover-color);
      color: var(--masks-primary-text-color);
      font-weight: bold;
    }
  }

  .sheet-header__fields .view-playbook {
    background: var(--masks-tab-bg-active-color);
    color: var(--masks-secondary-text-color);
    opacity: 1;
    border: 0.5px solid var(--masks-interactive-bg-hover-color);
  
    &:hover {
      opacity: 1;
      background: var(--masks-interactive-bg-hover-color);
    }
  }

  /** Playbook customizations **/
  .cell--theReformed {
    input[type="checkbox"] {
      margin: 3px 1px;
      flex: 0 0 14px;
    }

    .cell__title {
      font-size: 20px;
    }
  }
  
  .cell--theScionGreatestEnemy,
  .cell--theScionGreatestVictim,
  .cell--theScionPersonalIdol,
  .cell--theScionGreatestLeader,
  .cell--theScionGreatestHero,
  .cell--theScionBiggestCelebrity {
    input[type="checkbox"] {
      margin: 3px 1px;
      flex: 0 0 14px;
    }

    .cell__title {
      font-size: 20px;
    }

    input[type="checkbox"] {
      &:nth-child(5n) {
        margin-left: 5px;
        &::before {
          display: inline-block;
          content: "";
          border-left: 2px solid #7a7971;
          height: 18px;
          margin: 0 -4px;
        }
      }
    }
  }

  .cell--Checkbox label {
    display: flex;
    align-items: center;
  }
}

/** NPCs **/
.pbta.sheet.npc {
  .sheet-main [data-tab=equipment] { display: none; }

  .sheet-wrapper {
    max-height: none;

    .sheet-header {
      background: none;
      margin-bottom: 10px;
      padding: 8px;
      max-height: none;
    }
  }
  
  .sheet-attributes {
    grid-column: span 5;
    grid-template-columns: repeat(5, minmax(0, 1fr));

    .cell-npc-text {
      grid-column: span 2;
      .editor {
        min-height: 150px;
        max-height: 150px;
      }
    }
  }

  .sheet-header__fields {
    padding: 0px;
  }

  .cell--aesthetics .cell--conditions ul.cell__checkboxes label {
    display: flex;
    align-items: center;
  }

  .sheet-attributes .cell-npc-text .editor .tox-editor-container {
    min-height: 150px;
    height: 100% !important;
  }
}

/** Items **/

.pbta.sheet.item.playbook {
  min-height: 600px;
  min-width: 800px;
}

.pbta.sheet .editor-content {
  .playbook {
    padding: 10px;

    h1 {
      width: 100%;
      text-align-last: center;
    }

    h2 {
      font-style: italic;
      position: relative;
      padding-left: 8px;
      color: var(--masks-input-text-color);
      letter-spacing: 0.05rem;
      font-size: 22px;
  
      &::before {
        /* z-index: -1; */
        content: "";
        position: absolute;
        left: 7px;
        top: 0;
        height: 2px;
        width: calc(100% - 10px);
        background-color: var(--masks-cell-title-border-color);
        transform: skewX(-15deg);
      }

      &::after {
        /* z-index: -1; */
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        width: 4px;
        background-color: var(--masks-cell-title-border-color);
        transform: skewX(-15deg);
      }
    }

    h1, h2, h3 {
      border-bottom: none;
    }

    h2, h3 {
      margin-top: 30px;
    }

    .special {
      color: #ae0000;
      font-weight: bold;
    }
  
    .rules {
      /* background-color: green; */
      display: flex;
      flex-flow: wrap;
      justify-content: space-between;
      align-content: flex-start;
      align-items: flex-start;
      gap: 10px 20px;

      div {
        width: 48%;

        h2:nth-child(1) {
          margin-top: 10px;
        }
      }
    }
  
    .extras {
      margin-top: 30px;
    }
  }
}

/* Minimal, Foundry-aligned styling for the GM Whisper control */

#xcard-btn-wrapper {
  display: inline-flex;
  align-items: center;
  margin: 0;
}

#xcard.ui-control.icon {
  transition: var(--ui-fade-delay);
}

#xcard.ui-control.icon:hover {
  background-color: var(--color-level-error);
}

/* A lightweight, inline HUD that sits wherever you mount it. */
#masks-team {
  /* Make centering in wide containers easy */
  width: 100%;
  display: flex;
  justify-content: center;
  /* Don't block clicks outside the panel */
  pointer-events: none;
  z-index: 100;
  margin: 0.25rem 0;

  /* Interactive inner content */
  .panel {
    pointer-events: auto;
    display: inline-flex;
    align-items: start;
    gap: 8px;
    padding: 12px;
    background: transparent;
    border: none;
    box-shadow: none;
    color: var(--masks-primary-text-color, #fff);
  }

  /* The only styled element: the "Team" tag */
  .tag {
    height: 100%;
    margin: 0;
    color: var(--masks-primary-text-color, #fff);
    background: var(--masks-interactive-bg-color, #3da7db);
    padding: 2px 8px;
    border-radius: 4px;
    font-weight: 700;
    text-transform: uppercase;
    font-style: italic;
    letter-spacing: 0.03em;
    font-size: 20px;
  }

  /* Keep native buttons; just a nudge to input width */
  input[name="team"] {
    max-width: 3.6rem;
    text-align: center;
  }
}

#scene-controls-tools {
  [data-tool="influenceGainOverThem"] {
    background-color: #4CAF50;
  }

  [data-tool="influenceMutual"] {
    background-color: #2196F3;
  }

  [data-tool="influenceGiveThemOverYou"] {
    background-color: #9C27B0;
  }

  [data-tool="influenceClear"] {
    background-color: #F44336;
  }

  [data-tool="forwardAdd"],
  [data-tool="ongoingAdd"],
  [data-tool="forwardRemove"],
  [data-tool="ongoingRemove"] {
    background-color: var(--masks-interactive-bg-color, #3da7db);
  }
}

.sheet {
  .influence-management {
    img[data-influence-action="hasInfluenceOver"] {
      filter: #9C27B0 !important;
    }

    img[data-influence-action="haveInfluenceOver"] {
      filter: #4CAF50 !important;
    }

    [data-influence-action="delete"] {
      color: #F44336;
    }
  }
}

/* PbtA acted-this-round overlay for combat tracker */
#combat {
  li.combatant {
    position: relative;

    >.pbta-gone-toggle {
      position: absolute;
      left: 4px;
      top: 4px;
      z-index: 2;
      opacity: 0;
      transition: var(--ui-fade-delay);
      width: 55px;
      height: 55px;
      /* line-height: 22px; */
      font-size: 65px;
      background-color: transparent;
      color: var(--color-level-success-bg)
        /* inherit Foundry button visuals via existing classes */
    }

    /* Reveal on row hover */
    &:hover>.pbta-gone-toggle {
      opacity: 0.4;
    }

    /* Keep visible while keyboard focusing the control */
    >.pbta-gone-toggle:focus {
      opacity: 0.4;
    }
  }
}

/* CUSTOMIZATIONS */

#chat h4 {
  /* color: red !important; */
  font-size: var(--font-size-13);
  line-height: 1.25;
  margin-bottom: 4px;
}

.pbta.sheet .cell--moves .item-name,
.pbta.sheet .cell--basic-moves .item-name,
.pbta.sheet .cell--starting-moves .item-name,
.pbta.sheet .cell--advanced-moves .item-name,
.pbta.sheet .cell--special-moves .item-name,
.pbta.sheet .cell--other-moves .item-name,
.pbta.sheet .cell--equipment .item-name,
.pbta.sheet .cell--spells .item-name {
  font-weight: normal;
  text-transform: none !important;
}

.tox.tox-tinymce {
  min-height: 300px;
}

.vtt #chat .message .shift.up {
  color: forestgreen;
}

.cell.look {
  display: none;
}

.cell.abilities {
  width: 100%;
}

[data-edit="system.details.abilities.value"] {
  min-height: 150px;
}

[data-edit="system.details.backstory.value"],
[data-edit="system.details.biography.value"] {
  min-height: 400px;
}

.pbta.sheet.actor {
  min-height: 80vh;
}

.sheet-bottom.flexrow {
  gap: 0;
}

#worldStylesheet .cm-editor {
  max-height: 300px;
}

.sheet-bottom>.sheet-look {
  min-width: 250px;
}

.token-initiative {
  display: none !important;
}

#hotbar {
  display: none;
}


/* Chat accents used by Turn Card "Use Influence" messages */
.vtt #chat .message .shift.up {
  color: forestgreen;
}

.vtt #chat .message .shift.down {
  color: #b00020;
}

/* ------------------------------------------------------------------------- */
/* Turn Cards HUD                                                            */
/* Complete rewrite with right-to-left cooldown bars and smooth animations   */
/* ------------------------------------------------------------------------- */

/* ------------------------------------------------------------------------- */
/* Turn Cards HUD                                                            */
/* Right-to-left cooldown burn-down + smooth drain transitions               */
/* ------------------------------------------------------------------------- */
/* ------------------------------------------------------------------------- */
/* Turn Cards HUD                                                            */
/* ------------------------------------------------------------------------- */

#masks-turncards {
  /* Layout */
  --tc-max-cols: 8;
  --tc-gap: 8px;

  /* Sizing (slightly smaller than before, still responsive) */
  --tc-card-width: clamp(104px, 7.8vw, 130px);
  
  --tc-card-aspect: 3 / 4;

  /* Do NOT change button sizes */
  --tc-control-size: 28px;
  --tc-forward-size: 24px;

  --tc-nameplate-height: 32px;
  --tc-status-bar-height: 26px;
  --tc-portrait-pad: 3px;

  /* Theme colors */
  --tc-border-outer: var(--masks-turncards-pentagon-color, #37372b);
  --tc-border-inner: var(--masks-turncards-card-base, #bda78a);
  --tc-frame-bg: var(--masks-turncards-secondary-bg, #ead0b0);
  --tc-nameplate-bg: var(--masks-turncards-card-base, #bda78a);
  --tc-hover-inner: var(--masks-turncards-active-bg, #d1a06e);

  --tc-action-bg: var(--masks-turncards-action-bg, #69c0ae);
  --tc-cooldown-bar-bg: var(--masks-turncards-cooldown-bar, #2ab6cb);
  --tc-cooldown-label-bg: rgba(0, 0, 0, 0.72);
  --tc-downed-bg: rgba(104, 59, 71, 0.92);
  /* --tc-downed-bg: rgba(104, 59, 71, 0.92); */

  --tc-potential-fill: var(--masks-turncards-potential-fill-color, #e7a345);
  --tc-forward-bg: #3f8aa0;

  --tc-cooldown-opacity: var(--masks-turncards-cooldown-opacity, 0.75);
  --tc-downed-opacity: 0.45;

  /* Bottom-right notch shading on nameplates */
  --tc-notch: rgba(0, 0, 0, 0.12);

  /* Motion */
  --tc-transition-fast: 150ms ease-out;
  --tc-transition-smooth: 400ms cubic-bezier(0.4, 0, 0.2, 1);
  --tc-transition-bar: 800ms cubic-bezier(0.25, 0.1, 0.25, 1);

  width: 100%;
  pointer-events: none;
  z-index: 101;
  padding: 0;

  .turncards-row {
    pointer-events: auto;
    display: flex;

    /* Wrap upward so the “main” row stays aligned to the bottom */
    flex-wrap: wrap-reverse;

    gap: var(--tc-gap);
    justify-content: center;

    /* Bottom-align cards within each line */
    align-items: flex-end;

    /* Width-cap to 8 cards max per row */
    width: 100%;
    max-width: calc((var(--tc-card-width) + var(--tc-gap)) * 8 - var(--tc-gap));
    margin: 0 auto;

    padding: 8px 12px;
  }

  .turncard {
    box-sizing: border-box;
    flex: 0 0 var(--tc-card-width);
    width: var(--tc-card-width);
    aspect-ratio: var(--tc-card-aspect);

    position: relative;
    border-radius: 1px;
    background: var(--tc-frame-bg);

    /* Outer dark border + inner tan border (matches reference framing) */
    border: 2px solid var(--tc-border-outer);
    box-shadow: 0 0 0 2px var(--tc-border-inner) inset, 0 2px 10px rgba(0, 0, 0, 0.35);

    overflow: hidden;
    cursor: pointer;

    transition:
      transform var(--tc-transition-fast),
      box-shadow var(--tc-transition-fast),
      filter var(--tc-transition-fast);

    &:hover {
      transform: translateY(-4px) scale(1.03);
      box-shadow: 0 0 0 2px var(--tc-hover-inner) inset, 0 10px 26px rgba(0, 0, 0, 0.45);
    }

    &:focus-visible {
      outline: 2px solid var(--color-focus-primary, #7a99ff);
      outline-offset: 2px;
    }

    &.turncard--team {
      cursor: default;

      &:hover {
        transform: none;
        box-shadow: 0 0 0 2px var(--tc-border-inner) inset, 0 2px 10px rgba(0, 0, 0, 0.35);
      }
    }

    &.is-cooldown .turncard__content {
      opacity: var(--tc-cooldown-opacity);
    }

    &.is-downed .turncard__content {
      opacity: var(--tc-downed-opacity);
    }

    &.is-downed .turncard__portrait img {
      filter: grayscale(1);
    }
  }

  .turncard__content {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    transition: opacity var(--tc-transition-smooth);
  }

  .turncard__portrait {
    position: relative;
    flex: 1 1 auto;
    background: var(--tc-frame-bg);
    padding: var(--tc-portrait-pad);
    overflow: hidden;

    img {
      box-sizing: border-box;
      margin: 0;
      display: block;
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: top center;

      /* Inner portrait frame line */
      border: 2px solid rgba(0, 0, 0, 0.75);
      box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.35) inset;

      transition: filter var(--tc-transition-smooth);
    }
  }

  .turncard__portrait--team {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    /* padding: 6px; */
    padding: 2px;
    background: linear-gradient(180deg, #6b5b95 0%, #4a3f6b 100%);
  }

  /* --- Status bar (always present) -------------------------------------- */

  .turncard__status-bar {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: var(--tc-status-bar-height);
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    z-index: 3;
  }

  .turncard__status-bar--cooldown {
    background: var(--tc-cooldown-label-bg);
  }

  .turncard__status-bar--downed {
    background: var(--tc-downed-bg);
  }

  .turncard__status-bar--ready {
    background: transparent;
  }

  /* Cooldown drains RIGHT → LEFT (anchored left, width shrinks) */
  .turncard__cooldown-bar {
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    width: calc(var(--cooldown-frac, 0) * 100%);
    background: var(--tc-cooldown-bar-bg);
    opacity: 0.7;
    transition: width var(--tc-transition-bar);
    z-index: 1;
  }

  .turncard__status-bar--downed .turncard__cooldown-bar {
    opacity: 0.7;
  }

  .turncard__status-label {
    position: relative;
    z-index: 2;
    font-size: 0.65rem;
    font-weight: 900;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: rgba(255, 255, 255, 0.92);
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.55);
    white-space: nowrap;
  }

  .turncard__status-bar--ready .turncard__status-label {
    opacity: 0;
  }

  /* --- Action overlay ---------------------------------------------------- */

  .turncard__action {
    box-sizing: border-box;
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: var(--tc-status-bar-height);
    display: flex;
    align-items: center;
    justify-content: center;

    background: var(--tc-action-bg);
    border: none;
    border-radius: 0;
    width: auto;
    padding: 0 8px;

    cursor: pointer;
    opacity: 0;
    pointer-events: none;
    transform: translateY(-4px);
    z-index: 4;

    transition:
      opacity var(--tc-transition-fast),
      transform var(--tc-transition-fast),
      filter var(--tc-transition-fast);

    &:hover:not(:disabled) {
      filter: brightness(1.05);
    }

    &:disabled {
      filter: grayscale(0.6) brightness(0.8);
      cursor: not-allowed;
    }

    .turncard__action-label {
      font-size: 0.7rem;
      font-weight: 900;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: rgba(255, 255, 255, 0.95);
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.4);
    }
  }

  .turncard:hover .turncard__action,
  .turncard:focus-within .turncard__action {
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0);
  }

  /* --- Nameplate + notch ------------------------------------------------- */

  .turncard__nameplate {
    box-sizing: border-box;
    position: relative;
    flex: 0 0 auto;
    height: var(--tc-nameplate-height);
    padding: 4px 6px;

    background: var(--tc-nameplate-bg);

    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;

    &::after {
      content: "";
      position: absolute;
      inset: 0;
      z-index: 0;
      background: linear-gradient(135deg, transparent 75% 55%, var(--tc-notch) 55% 100%);
      pointer-events: none;
    }
  }

  .turncard__name {
    position: relative;
    z-index: 1;
    text-transform: uppercase;
    font-weight: 900;
    font-size: 1rem;
    letter-spacing: 0.03em;
    color: rgba(0, 0, 0, 0.85);

    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
  }

  /* --- Corner controls --------------------------------------------------- */

  .turncard__shift,
  .turncard__forward,
  .turncard__potential {
    box-sizing: border-box;
    position: absolute;
    padding: 0;
    display: inline-flex;
    align-items: center;
    justify-content: center;

    cursor: pointer;
    z-index: 5;

    transition:
      transform var(--tc-transition-fast),
      filter var(--tc-transition-fast),
      opacity var(--tc-transition-fast);

    border-radius: 50%;

    &:hover:not(:disabled) {
      transform: scale(1.15);
      filter: brightness(1.12);
    }

    &:active:not(:disabled) {
      transform: scale(0.95);
    }

    &.is-disabled,
    &:disabled {
      opacity: 1;
      cursor: default;

      &:hover {
        transform: none;
        filter: none;
      }
    }
  }

  .turncard__shift {
    left: 4px;
    bottom: 4px;
    width: var(--tc-control-size);
    height: var(--tc-control-size);
    background: rgba(0, 0, 0, 0.55);
    border: 1px solid rgba(255, 255, 255, 0.85);
  }

  /* Labels Graph - Pentagon visualization button */
  .turncard__labels-graph {
    /* Override circular shape - use pentagon clip-path */
    border-radius: 0;
    clip-path: polygon(50% 0%, 100% 38%, 81% 100%, 19% 100%, 0% 38%);

    /* Position tightly in corner */
    left: 2px;
    bottom: 2px;

    /* 40x40px size */
    width: 40px;
    height: 40px;

    /* Higher z-index than Forward button */
    z-index: 6;

    /* Remove default background/border since SVG handles it */
    background: transparent;
    border: none;

    /* Center the SVG */
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;

    /* SVG fills the button */
    .labels-graph-svg {
      width: 100%;
      height: 100%;
      display: block;
    }

    /* Hover/active states */
    &:hover:not(:disabled) {
      transform: scale(1.2);
      filter: brightness(1.15);
    }

    &:active:not(:disabled) {
      transform: scale(1.05);
    }

    /* Disabled state - keep full opacity but indicate non-interactive */
    &.is-disabled,
    &:disabled {
      opacity: 1;
      cursor: default;

      &:hover {
        transform: none;
        filter: none;
      }
    }
  }

  .turncard__forward {
    left: 10px;
    bottom: 38px;
    width: var(--tc-forward-size);
    height: var(--tc-forward-size);
    font-size: 0.75rem;

    background: rgba(0, 0, 0, 0.35);
    border: 1px solid transparent;

    color: #fff;

    .turncard__forward-value {
      font-size: 0.7rem;
      font-weight: 900;
    }

    i {
      font-size: 0.65rem;
    }

    &.has-bonus {
      background: var(--tc-forward-bg);
      box-shadow: 0 2px 6px rgba(59, 130, 246, 0.35);
      border: 1px solid rgba(255, 255, 255, 0.92);
    }
  }

  .turncard__potential {
    right: 6px;
    bottom: 6px;
    width: var(--tc-control-size);
    height: var(--tc-control-size);

    background: rgba(55, 55, 43, 0.75);
    border: 1px solid rgba(255, 255, 255, 0.92);
    overflow: hidden;

    &::before {
      content: "";
      position: absolute;
      inset: auto 0 0 0;
      height: var(--potential-fill, 0%);
      background: var(--tc-potential-fill);
      transition: height var(--tc-transition-smooth);
    }

    i {
      position: relative;
      z-index: 1;
      color: #fff;
      font-size: 0.75rem;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
    }

    &.is-bump {
      animation: tc-bump 200ms ease-out;
    }
  }

  /* --- Team card internals ---------------------------------------------- */

  .turncard__team {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 6px;
  }

  .turncard__team-label {
    font-size: 0.7rem;
    font-weight: 900;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: rgba(255, 255, 255, 0.85);
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.35);
  }

  .turncard__team-value {
    font-size: 2rem;
    font-weight: 900;
    letter-spacing: 0.04em;
    color: rgba(255, 255, 255, 0.95);
    text-shadow: 0 2px 6px rgba(0, 0, 0, 0.45);
    line-height: 1;
  }

  .turncard__team-controls {
    display: flex;
    gap: 2px;

    /* lets it remain responsive at smaller widths without changing btn sizes */
    flex-wrap: nowrap;
    justify-content: space-evenly;
  }

  .turncard__team-btn {
    box-sizing: border-box;
    width: calc(var(--tc-control-size) - 2px);
    height: calc(var(--tc-control-size) - 2px);

    padding: 0;
    border-radius: 3px;

    border: 2px solid rgba(255, 255, 255, 0.55);
    background: rgba(0, 0, 0, 0.25);
    color: #fff;

    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;

    transition:
      background-color var(--tc-transition-fast),
      transform var(--tc-transition-fast),
      border-color var(--tc-transition-fast);

    &:hover:not(:disabled) {
      background: rgba(255, 255, 255, 0.18);
      border-color: rgba(255, 255, 255, 0.85);
      transform: scale(1.08);
    }

    &:active:not(:disabled) {
      transform: scale(0.95);
    }

    &:disabled {
      opacity: 0.35;
      cursor: not-allowed;

      &:hover {
        background: rgba(0, 0, 0, 0.25);
        transform: none;
        border-color: rgba(255, 255, 255, 0.55);
      }
    }

    i {
      font-size: 0.75rem;
    }
  }

  @keyframes tc-bump {
    0% {
      transform: scale(1);
    }

    50% {
      transform: scale(1.25);
    }

    100% {
      transform: scale(1);
    }
  }
}

/* Fallback for browsers without aspect-ratio */
@supports not (aspect-ratio: 1) {
  #masks-turncards .turncard {
    height: calc(var(--tc-card-width) * 4 / 3);
  }
}

/* =========================================================================== */
/* MASKS SHEET V2 - Redesigned Character Sheet                                 */
/* =========================================================================== */

:root {
  /* Layout */
  --masks-v2-sheet-min-width: 900px;
  --masks-v2-left-panel-width: 280px;
  --masks-v2-sidebar-width: 220px;
  --masks-v2-corner-radius: 2px;
  --masks-v2-transition-speed: 150ms;
  --masks-v2-transition-smooth: 300ms;

  /* Label Colors */
  --masks-danger-color: #e05252;
  --masks-danger-color-light: rgba(224, 82, 82, 0.15);
  --masks-freak-color: #9b59b6;
  --masks-freak-color-light: rgba(155, 89, 182, 0.15);
  --masks-savior-color: #3498db;
  --masks-savior-color-light: rgba(52, 152, 219, 0.15);
  --masks-superior-color: #f39c12;
  --masks-superior-color-light: rgba(243, 156, 18, 0.15);
  --masks-mundane-color: #27ae60;
  --masks-mundane-color-light: rgba(39, 174, 96, 0.15);

  /* Condition Colors (matching affected labels) */
  --masks-afraid-color: var(--masks-danger-color);
  --masks-angry-color: var(--masks-mundane-color);
  --masks-guilty-color: var(--masks-superior-color);
  --masks-hopeless-color: var(--masks-freak-color);
  --masks-insecure-color: var(--masks-savior-color);

  /* V2 Theme */
  --masks-v2-panel-bg: rgba(20, 30, 45, 0.95);
  --masks-v2-sidebar-bg: rgba(30, 40, 55, 0.92);
  --masks-v2-tab-bg: rgba(40, 50, 65, 0.9);
  --masks-v2-tab-active-bg: rgba(60, 75, 95, 0.95);
  --masks-v2-text-primary: #ffffff;
  --masks-v2-text-secondary: rgba(255, 255, 255, 0.75);
  --masks-v2-text-muted: rgba(255, 255, 255, 0.5);
  --masks-v2-border-color: rgba(255, 255, 255, 0.15);
  --masks-v2-border-accent: rgba(61, 167, 219, 0.5);
  --masks-v2-input-bg: rgba(0, 0, 0, 0.3);
  --masks-v2-accent-color: #3da7db;
}

/* Main Sheet Container */
.pbta.sheet.actor .masks-sheet-v2 {
  background: transparent;
}

.masks-sheet-v2 .masks-sheet {
  display: grid;
  grid-template-columns: var(--masks-v2-left-panel-width) 1fr;
  height: 100%;
  min-height: 600px;
  gap: 0;
  background: var(--masks-v2-panel-bg);
  border-radius: var(--masks-v2-corner-radius);
  overflow: hidden;
}

/* =========================================================================== */
/* LEFT PANEL - Portrait, Identity, Conditions                                  */
/* =========================================================================== */

.masks-sheet-v2 .masks-left-panel {
  display: flex;
  flex-direction: column;
  background: linear-gradient(180deg, rgba(20, 30, 45, 0.98) 0%, rgba(15, 25, 40, 0.98) 100%);
  border-right: 1px solid var(--masks-v2-border-color);
  padding: 16px;
  gap: 16px;
}

/* Character Portrait */
.masks-sheet-v2 .character-portrait {
  position: relative;
  width: 100%;
  aspect-ratio: 1;
  border-radius: var(--masks-v2-corner-radius);
  overflow: hidden;
  border: 2px solid var(--masks-v2-border-accent);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);

  .profile-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: top center;
    cursor: pointer;
    transition: transform var(--masks-v2-transition-smooth) ease;

    &:hover {
      transform: scale(1.02);
    }
  }
}

/* Character Identity */
.masks-sheet-v2 .character-identity {
  display: flex;
  flex-direction: column;
  gap: 8px;

  .character-name {
    font-size: 1.5rem;
    font-weight: 900;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--masks-v2-text-primary);
    background: transparent;
    border: none;
    border-bottom: 2px solid var(--masks-v2-border-accent);
    padding: 4px 0;
    width: 100%;

    &::placeholder {
      color: var(--masks-v2-text-muted);
    }

    &:focus {
      outline: none;
      border-bottom-color: var(--masks-v2-accent-color);
    }
  }

  .character-real-name {
    font-size: 1rem;
    font-style: italic;
    color: var(--masks-v2-text-secondary);
    background: transparent;
    border: none;
    border-bottom: 1px solid var(--masks-v2-border-color);
    padding: 4px 0;
    width: 100%;

    &::placeholder {
      color: var(--masks-v2-text-muted);
      font-style: italic;
    }

    &:focus {
      outline: none;
      border-bottom-color: var(--masks-v2-accent-color);
    }
  }

  .playbook-row {
    display: flex;
    gap: 8px;
    align-items: center;
    margin-top: 4px;
    min-width: 0; /* Allow flex items to shrink */

    .playbook-select {
      flex: 1;
      min-width: 0; /* Fix overflow */
      background: var(--masks-v2-input-bg);
      border: 1px solid var(--masks-v2-border-color);
      border-radius: var(--masks-v2-corner-radius);
      color: var(--masks-v2-text-primary);
      padding: 6px 8px;
      font-size: 0.9rem;
      cursor: pointer;
      text-overflow: ellipsis;
      overflow: hidden;
      white-space: nowrap;

      &:focus {
        outline: none;
        border-color: var(--masks-v2-accent-color);
      }

      option {
        background: var(--masks-v2-panel-bg);
        color: var(--masks-v2-text-primary);
      }
    }

    .playbook-link {
      flex-shrink: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--masks-v2-input-bg);
      border: 1px solid var(--masks-v2-border-color);
      border-radius: var(--masks-v2-corner-radius);
      color: var(--masks-v2-text-muted);
      cursor: pointer;
      transition: all var(--masks-v2-transition-speed) ease;

      &:hover {
        background: var(--masks-v2-accent-color);
        color: var(--masks-v2-text-primary);
        border-color: var(--masks-v2-accent-color);
      }

      &.active {
        color: var(--masks-v2-accent-color);
      }
    }
  }
}

/* =========================================================================== */
/* CONDITIONS PANEL                                                             */
/* =========================================================================== */

.masks-sheet-v2 .conditions-panel {
  /* No margin-top: auto - conditions appear directly under character identity */

  .conditions-title {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--masks-v2-text-muted);
    margin-bottom: 8px;
  }

  .conditions-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
  }

  .condition-tag {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 10px;
    background: var(--masks-v2-input-bg);
    border: 1px solid var(--masks-v2-border-color);
    border-radius: var(--masks-v2-corner-radius);
    color: var(--masks-v2-text-secondary);
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    cursor: pointer;
    transition: all var(--masks-v2-transition-speed) ease;

    i {
      font-size: 0.75rem;
    }

    &:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    /* Condition colors when active - match the LABEL they affect */
    /* Afraid affects Danger (red) */
    &.condition--afraid.active {
      background: rgba(224, 82, 82, 0.7);
      border-color: var(--masks-danger-color);
      color: white;
    }

    /* Angry affects Mundane (green) */
    &.condition--angry.active {
      background: rgba(39, 174, 96, 0.7);
      border-color: var(--masks-mundane-color);
      color: white;
    }

    /* Guilty affects Superior (gold) */
    &.condition--guilty.active {
      background: rgba(243, 156, 18, 0.7);
      border-color: var(--masks-superior-color);
      color: white;
    }

    /* Hopeless affects Freak (purple) */
    &.condition--hopeless.active {
      background: rgba(155, 89, 182, 0.7);
      border-color: var(--masks-freak-color);
      color: white;
    }

    /* Insecure affects Savior (blue) */
    &.condition--insecure.active {
      background: rgba(52, 152, 219, 0.7);
      border-color: var(--masks-savior-color);
      color: white;
    }

    /* Inactive state with color hint - match the LABEL they affect */
    &.condition--afraid:not(.active) {
      border-left: 3px solid var(--masks-danger-color);
    }

    &.condition--angry:not(.active) {
      border-left: 3px solid var(--masks-mundane-color);
    }

    &.condition--guilty:not(.active) {
      border-left: 3px solid var(--masks-superior-color);
    }

    &.condition--hopeless:not(.active) {
      border-left: 3px solid var(--masks-freak-color);
    }

    &.condition--insecure:not(.active) {
      border-left: 3px solid var(--masks-savior-color);
    }
  }
}

/* =========================================================================== */
/* RIGHT SECTION - Tabs + Sidebar                                               */
/* =========================================================================== */

.masks-sheet-v2 .masks-sheet__right {
  display: grid;
  grid-template-columns: 1fr var(--masks-v2-sidebar-width);
  height: 100%;
  overflow: hidden;
}

/* Tabs Container */
.masks-sheet-v2 .tabs-container {
  display: flex;
  flex-direction: column;
  height: 100%;
  overflow: hidden;
}

/* Tab Navigation */
.masks-sheet-v2 .sheet-tabs.tabs {
  display: flex;
  gap: 2px;
  padding: 8px 12px 0;
  background: var(--masks-v2-tab-bg);
  border-bottom: none;

  .tab-btn {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 10px 16px;
    background: transparent;
    border: none;
    border-radius: var(--masks-v2-corner-radius) var(--masks-v2-corner-radius) 0 0;
    color: var(--masks-v2-text-muted);
    font-size: 0.85rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    cursor: pointer;
    transition: all var(--masks-v2-transition-speed) ease;

    i {
      font-size: 0.9rem;
    }

    &:hover {
      color: var(--masks-v2-text-secondary);
      background: rgba(255, 255, 255, 0.05);
    }

    &.active {
      color: var(--masks-v2-text-primary);
      background: var(--masks-v2-tab-active-bg);
    }
  }
}

/* Tab Content */
.masks-sheet-v2 .tab-content {
  flex: 1;
  overflow-y: auto;
  background: var(--masks-v2-tab-active-bg);
  padding: 16px;

  .tab {
    display: none;

    &.active {
      display: block;
    }
  }

  .sheet-tab {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }
}

/* Section Styling */
.masks-sheet-v2 .section-title,
.masks-sheet-v2 .sidebar-title {
  font-size: 0.75rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--masks-v2-accent-color);
  margin-bottom: 8px;
  padding-bottom: 4px;
  border-bottom: 1px solid var(--masks-v2-border-color);
}

.masks-sheet-v2 .section-description {
  font-size: 0.85rem;
  color: var(--masks-v2-text-muted);
  font-style: italic;
  margin-bottom: 8px;
}

/* Editor Styling */
.masks-sheet-v2 .editor {
  min-height: 100px;

  .editor-content {
    background: var(--masks-v2-input-bg);
    border: 1px solid var(--masks-v2-border-color);
    border-radius: var(--masks-v2-corner-radius);
    color: var(--masks-v2-text-primary);
    padding: 8px;
    min-height: 80px;
  }
}

/* =========================================================================== */
/* STATS SIDEBAR                                                                */
/* =========================================================================== */

.masks-sheet-v2 .stats-sidebar {
  background: var(--masks-v2-sidebar-bg);
  border-left: 1px solid var(--masks-v2-border-color);
  padding: 16px;
  display: flex;
  flex-direction: column;
  gap: 20px;
  overflow-y: auto;
}

/* Labels Section */
.masks-sheet-v2 .labels-section {
  .labels-graph-clickable {
    display: flex;
    justify-content: center;
    margin-bottom: 12px;
    cursor: pointer;
    transition: transform var(--masks-v2-transition-speed) ease;

    &:hover {
      transform: scale(1.05);
    }

    .labels-graph-svg {
      width: 100px;
      height: 100px;
    }
  }

  .labels-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  /* Two-row label layout: Row 1: Icon | Name | Lock, Row 2: - | Value | + */
  .label-row {
    display: flex;
    flex-direction: column;
    gap: 4px;
    background: var(--masks-v2-input-bg);
    border: 1px solid var(--masks-v2-border-color);
    border-radius: var(--masks-v2-corner-radius);
    padding: 6px 8px;
    transition: all var(--masks-v2-transition-speed) ease;

    &:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    &.locked {
      opacity: 0.6;

      .label-row-bottom {
        pointer-events: none;
      }
    }

    .label-row-top {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .label-row-bottom {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
    }

    /* Label-specific colors */
    &.label--danger {
      border-left: 3px solid var(--masks-danger-color);
      .label-icon { color: var(--masks-danger-color); }
    }

    &.label--freak {
      border-left: 3px solid var(--masks-freak-color);
      .label-icon { color: var(--masks-freak-color); }
    }

    &.label--savior {
      border-left: 3px solid var(--masks-savior-color);
      .label-icon { color: var(--masks-savior-color); }
    }

    &.label--superior {
      border-left: 3px solid var(--masks-superior-color);
      .label-icon { color: var(--masks-superior-color); }
    }

    &.label--mundane {
      border-left: 3px solid var(--masks-mundane-color);
      .label-icon { color: var(--masks-mundane-color); }
    }

    .label-icon {
      font-size: 0.85rem;
      width: 16px;
      text-align: center;
      flex-shrink: 0;
    }

    .label-name {
      flex: 1;
      font-size: 0.7rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.03em;
      color: var(--masks-v2-text-primary);
      min-width: 0;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .label-lock {
      flex-shrink: 0;
      width: 20px;
      height: 20px;
      padding: 0;
      background: transparent;
      border: none;
      color: var(--masks-v2-text-muted);
      cursor: pointer;
      font-size: 0.65rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color var(--masks-v2-transition-speed) ease;

      &:hover {
        color: var(--masks-v2-text-primary);
      }
    }

    .label-btn {
      flex-shrink: 0;
      width: 22px;
      height: 22px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--masks-v2-input-bg);
      border: 1px solid var(--masks-v2-border-color);
      border-radius: var(--masks-v2-corner-radius);
      color: var(--masks-v2-text-secondary);
      cursor: pointer;
      font-size: 0.65rem;
      line-height: 1;
      transition: all var(--masks-v2-transition-speed) ease;

      i {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        height: 100%;
      }

      &:hover:not(:disabled) {
        background: var(--masks-v2-accent-color);
        color: white;
        border-color: var(--masks-v2-accent-color);
      }

      &:disabled {
        opacity: 0.3;
        cursor: not-allowed;
      }
    }

    .label-value {
      flex-shrink: 0;
      width: 32px;
      text-align: center;
      background: transparent;
      border: none;
      color: var(--masks-v2-text-primary);
      font-size: 1rem;
      font-weight: 700;

      &:focus {
        outline: none;
      }

      /* Hide spinner buttons */
      &::-webkit-outer-spin-button,
      &::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }

      -moz-appearance: textfield;
    }
  }

  /* Remove old nested structures - now single row */
  .label-header,
  .label-controls {
    display: contents;
  }
}

/* Potential Section */
.masks-sheet-v2 .potential-section {
  .potential-tracker {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
  }

  .potential-pips {
    display: flex;
    gap: 4px;

    .potential-pip {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: var(--masks-v2-input-bg);
      border: 2px solid var(--masks-v2-border-color);
      cursor: pointer;
      transition: all var(--masks-v2-transition-speed) ease;

      &:hover {
        border-color: var(--masks-turncards-potential-fill-color);
        transform: scale(1.1);
      }

      &.filled {
        background: var(--masks-turncards-potential-fill-color);
        border-color: var(--masks-turncards-potential-fill-color);
      }
    }
  }

  .potential-count {
    font-size: 0.75rem;
    color: var(--masks-v2-text-muted);
  }
}

/* Modifier Sections (Forward/Ongoing) */
.masks-sheet-v2 .modifier-section {
  .modifier-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px;
    background: var(--masks-v2-input-bg);
    border: 1px solid var(--masks-v2-border-color);
    border-radius: var(--masks-v2-corner-radius);
  }

  .modifier-label {
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--masks-v2-text-secondary);
  }

  .modifier-controls {
    display: flex;
    align-items: center;
    gap: 4px;

    .modifier-btn {
      width: 22px;
      height: 22px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--masks-v2-input-bg);
      border: 1px solid var(--masks-v2-border-color);
      border-radius: var(--masks-v2-corner-radius);
      color: var(--masks-v2-text-secondary);
      cursor: pointer;
      font-size: 0.65rem;
      transition: all var(--masks-v2-transition-speed) ease;

      &:hover {
        background: var(--masks-v2-accent-color);
        color: white;
        border-color: var(--masks-v2-accent-color);
      }
    }

    .modifier-value {
      width: 40px;
      text-align: center;
      background: transparent;
      border: none;
      color: var(--masks-v2-text-primary);
      font-size: 1rem;
      font-weight: 700;

      &:focus {
        outline: none;
      }

      &::-webkit-outer-spin-button,
      &::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }

      -moz-appearance: textfield;
    }
  }
}

/* Playbook Attributes Section */
.masks-sheet-v2 .playbook-attrs-section {
  .playbook-attr {
    margin-bottom: 12px;

    .attr-label {
      display: block;
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--masks-v2-text-muted);
      margin-bottom: 4px;
    }

    .clock-pips {
      display: flex;
      gap: 4px;
      flex-wrap: wrap;

      .clock-pip {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: var(--masks-v2-input-bg);
        border: 2px solid var(--masks-v2-border-color);
        cursor: pointer;
        transition: all var(--masks-v2-transition-speed) ease;

        &:hover {
          border-color: var(--masks-danger-color);
        }

        &.filled {
          background: var(--masks-danger-color);
          border-color: var(--masks-danger-color);
        }
      }
    }

    .number-controls {
      display: flex;
      align-items: center;
      gap: 4px;

      .attr-btn {
        width: 24px;
        height: 24px;
        padding: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--masks-v2-input-bg);
        border: 1px solid var(--masks-v2-border-color);
        border-radius: var(--masks-v2-corner-radius);
        color: var(--masks-v2-text-secondary);
        cursor: pointer;
        transition: all var(--masks-v2-transition-speed) ease;

        &:hover {
          background: var(--masks-v2-accent-color);
          color: white;
        }
      }

      input {
        width: 50px;
        text-align: center;
        background: var(--masks-v2-input-bg);
        border: 1px solid var(--masks-v2-border-color);
        border-radius: var(--masks-v2-corner-radius);
        color: var(--masks-v2-text-primary);
        font-weight: 600;

        &:focus {
          outline: none;
          border-color: var(--masks-v2-accent-color);
        }
      }
    }

    textarea {
      width: 100%;
      min-height: 60px;
      background: var(--masks-v2-input-bg);
      border: 1px solid var(--masks-v2-border-color);
      border-radius: var(--masks-v2-corner-radius);
      color: var(--masks-v2-text-primary);
      padding: 6px;
      font-size: 0.8rem;
      resize: vertical;

      &:focus {
        outline: none;
        border-color: var(--masks-v2-accent-color);
      }
    }

    .attr-checklist {
      list-style: none;
      padding: 0;
      margin: 0;

      li {
        margin-bottom: 4px;

        label {
          display: flex;
          align-items: center;
          gap: 6px;
          font-size: 0.8rem;
          color: var(--masks-v2-text-secondary);
          cursor: pointer;

          input[type="checkbox"] {
            accent-color: var(--masks-v2-accent-color);
          }

          input[type="text"] {
            flex: 1;
            background: var(--masks-v2-input-bg);
            border: 1px solid var(--masks-v2-border-color);
            border-radius: var(--masks-v2-corner-radius);
            color: var(--masks-v2-text-primary);
            padding: 2px 6px;
            font-size: 0.8rem;

            &:focus {
              outline: none;
              border-color: var(--masks-v2-accent-color);
            }
          }
        }
      }
    }
  }
}

/* =========================================================================== */
/* INFO TAB                                                                     */
/* =========================================================================== */

.masks-sheet-v2 .info-tab {
  .info-section {
    margin-bottom: 16px;

    &:last-child {
      margin-bottom: 0;
    }
  }

  .section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 8px;

    .section-title {
      margin-bottom: 0;
      padding-bottom: 0;
      border-bottom: none;
    }

    .influence-create {
      width: 28px;
      height: 28px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--masks-v2-accent-color);
      border: none;
      border-radius: var(--masks-v2-corner-radius);
      color: white;
      cursor: pointer;
      transition: all var(--masks-v2-transition-speed) ease;

      &:hover {
        transform: scale(1.1);
        filter: brightness(1.1);
      }
    }
  }

  .influences-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .influence-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px;
    background: var(--masks-v2-input-bg);
    border: 1px solid var(--masks-v2-border-color);
    border-radius: var(--masks-v2-corner-radius);
    transition: opacity var(--masks-v2-transition-speed) ease;

    /* Locked state */
    &.locked {
      opacity: 0.7;
      border-left: 3px solid var(--masks-v2-accent-color);

      .influence-name-input {
        cursor: default;
      }
    }

    .influence-name-row {
      flex: 1;

      .influence-name-input {
        width: 100%;
        background: transparent;
        border: none;
        border-bottom: 1px solid transparent;
        color: var(--masks-v2-text-primary);
        font-size: 0.9rem;
        padding: 2px 0;

        &:focus {
          outline: none;
          border-bottom-color: var(--masks-v2-accent-color);
        }

        &[readonly] {
          cursor: default;
        }
      }
    }

    .influence-controls {
      display: flex;
      gap: 4px;

      .influence-btn {
        width: 28px;
        height: 28px;
        padding: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        gap: 2px;
        background: var(--masks-v2-input-bg);
        border: 1px solid var(--masks-v2-border-color);
        border-radius: var(--masks-v2-corner-radius);
        color: var(--masks-v2-text-muted);
        cursor: pointer;
        font-size: 0.55rem;
        line-height: 1;
        transition: all var(--masks-v2-transition-speed) ease;

        i {
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 0.65rem;
        }

        span {
          display: none;
        }

        &:hover:not(:disabled) {
          background: var(--masks-v2-accent-color);
          color: white;
          border-color: var(--masks-v2-accent-color);
        }

        &.active {
          background: var(--masks-v2-accent-color);
          color: white;
          border-color: var(--masks-v2-accent-color);
        }

        &:disabled {
          opacity: 0.4;
          cursor: not-allowed;
        }

        &.influence-delete-btn:hover:not(:disabled) {
          background: var(--masks-danger-color);
          border-color: var(--masks-danger-color);
        }
      }
    }
  }

  .no-influences {
    font-size: 0.85rem;
    color: var(--masks-v2-text-muted);
    font-style: italic;
    text-align: center;
    padding: 16px;
  }
}

/* =========================================================================== */
/* POWERS TAB                                                                   */
/* =========================================================================== */

.masks-sheet-v2 .powers-tab {
  .powers-modifiers {
    display: flex;
    gap: 16px;
    margin-bottom: 16px;
    padding: 12px;
    background: var(--masks-v2-input-bg);
    border: 1px solid var(--masks-v2-border-color);
    border-radius: var(--masks-v2-corner-radius);

    .modifier-field {
      display: flex;
      align-items: center;
      gap: 8px;

      label {
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--masks-v2-text-muted);
        white-space: nowrap;
      }

      input[type="text"] {
        width: 80px;
        background: var(--masks-v2-sidebar-bg);
        border: 1px solid var(--masks-v2-border-color);
        border-radius: var(--masks-v2-corner-radius);
        color: var(--masks-v2-text-primary);
        padding: 4px 8px;
        font-size: 0.85rem;

        &:focus {
          outline: none;
          border-color: var(--masks-v2-accent-color);
        }
      }

      .modifier-stepper {
        display: flex;
        align-items: center;
        gap: 4px;

        button {
          width: 24px;
          height: 24px;
          padding: 0;
          display: flex;
          align-items: center;
          justify-content: center;
          background: var(--masks-v2-sidebar-bg);
          border: 1px solid var(--masks-v2-border-color);
          border-radius: var(--masks-v2-corner-radius);
          color: var(--masks-v2-text-secondary);
          cursor: pointer;
          transition: all var(--masks-v2-transition-speed) ease;

          &:hover {
            background: var(--masks-v2-accent-color);
            color: white;
            border-color: var(--masks-v2-accent-color);
          }
        }

        input {
          width: 40px;
          text-align: center;
          background: var(--masks-v2-sidebar-bg);
          border: 1px solid var(--masks-v2-border-color);
          border-radius: var(--masks-v2-corner-radius);
          color: var(--masks-v2-text-primary);
          font-weight: 600;

          &:focus {
            outline: none;
            border-color: var(--masks-v2-accent-color);
          }
        }
      }
    }
  }

  .moves-container {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .moves-group {
    background: var(--masks-v2-input-bg);
    border: 1px solid var(--masks-v2-border-color);
    border-radius: var(--masks-v2-corner-radius);
    overflow: hidden;

    &.collapsed .moves-list {
      grid-template-rows: 0fr;
      opacity: 0;
    }

    &.collapsed .moves-collapse-icon i {
      transform: rotate(180deg);
    }
  }

  .moves-group-header {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 12px;
    background: rgba(255, 255, 255, 0.05);
    cursor: pointer;
    transition: background var(--masks-v2-transition-speed) ease;

    &:hover {
      background: rgba(255, 255, 255, 0.08);
    }

    .moves-group-title {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 0;
      font-size: 0.85rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--masks-v2-text-primary);

      i {
        color: var(--masks-v2-accent-color);
      }
    }

    .moves-collapse-icon {
      color: var(--masks-v2-text-muted);

      i {
        font-size: 0.75rem;
        transition: transform 0.3s ease;
      }
    }

    .moves-add-btn {
      width: 24px;
      height: 24px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--masks-v2-accent-color);
      border: none;
      border-radius: var(--masks-v2-corner-radius);
      color: white;
      cursor: pointer;
      font-size: 0.7rem;
      transition: all var(--masks-v2-transition-speed) ease;

      &:hover {
        transform: scale(1.1);
        filter: brightness(1.1);
      }
    }
  }

  .moves-list {
    list-style: none;
    padding: 0;
    margin: 0;
    /* Use grid for smooth height animation */
    display: grid;
    grid-template-rows: 1fr;
    opacity: 1;
    transition: grid-template-rows 0.2s ease-out, opacity 0.2s ease-out;

    > * {
      overflow: hidden;
    }
  }

  .move-item {
    border-top: 1px solid var(--masks-v2-border-color);

    &:first-child {
      border-top: none;
    }
  }

  .move-content {
    padding: 10px 12px;

    .move-header {
      display: flex;
      align-items: center;
      gap: 8px;

      .move-icon {
        flex-shrink: 0;
        width: 28px;
        height: 28px;
        border: 1px solid var(--masks-v2-border-color);
        border-radius: var(--masks-v2-corner-radius);
        background: var(--masks-v2-input-bg);
        object-fit: cover;
        cursor: pointer;
        transition: all var(--masks-v2-transition-speed) ease;

        &:hover {
          transform: scale(1.1);
          box-shadow: 0 2px 8px rgba(61, 167, 219, 0.3);
        }

        /* Rollable moves - dice hover effect */
        &.rollable:hover {
          border-color: var(--masks-v2-accent-color);
          background: var(--masks-v2-accent-color);
        }

        /* Non-rollable moves - share/chat hover effect */
        &:not(.rollable):hover {
          border-color: var(--masks-mundane-color, #7fdbff);
          background: var(--masks-mundane-color, #7fdbff);
        }
      }

      .move-name {
        flex: 1;
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--masks-v2-text-primary);
        cursor: pointer;
        transition: color var(--masks-v2-transition-speed) ease;

        &:hover {
          text-decoration: underline;
        }
      }
    }

    /* Color-code moves by rollType */
    &.roll-danger .move-name {
      color: var(--masks-danger-color);
    }

    &.roll-freak .move-name {
      color: var(--masks-freak-color);
    }

    &.roll-savior .move-name {
      color: var(--masks-savior-color);
    }

    &.roll-superior .move-name {
      color: var(--masks-superior-color);
    }

    &.roll-mundane .move-name {
      color: var(--masks-mundane-color);
    }

    /* Hover state - brighten move row for rollable moves */
    &.has-roll:hover {
      background: rgba(255, 255, 255, 0.03);
    }

    .move-header {
      /* Move tag with label tint */
      .move-tag {
        flex-shrink: 0;
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 3px 8px;
        font-size: 0.65rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        border-radius: var(--masks-v2-corner-radius);
        background: rgba(255, 255, 255, 0.1);
        color: var(--masks-v2-text-secondary);

        i {
          font-size: 0.7rem;
        }

        /* Label-specific tints */
        &.label-danger {
          background: var(--masks-danger-color-light);
          color: var(--masks-danger-color);
          border: 1px solid var(--masks-danger-color);
        }

        &.label-freak {
          background: var(--masks-freak-color-light);
          color: var(--masks-freak-color);
          border: 1px solid var(--masks-freak-color);
        }

        &.label-savior {
          background: var(--masks-savior-color-light);
          color: var(--masks-savior-color);
          border: 1px solid var(--masks-savior-color);
        }

        &.label-superior {
          background: var(--masks-superior-color-light);
          color: var(--masks-superior-color);
          border: 1px solid var(--masks-superior-color);
        }

        &.label-mundane {
          background: var(--masks-mundane-color-light);
          color: var(--masks-mundane-color);
          border: 1px solid var(--masks-mundane-color);
        }
      }

      .move-actions {
        flex-shrink: 0;
        display: flex;
        gap: 4px;
        opacity: 0.5;
        transition: opacity var(--masks-v2-transition-speed) ease;

        .move-action {
          width: 26px;
          height: 26px;
          padding: 0;
          display: flex;
          align-items: center;
          justify-content: center;
          background: var(--masks-v2-input-bg);
          border: 1px solid var(--masks-v2-border-color);
          border-radius: var(--masks-v2-corner-radius);
          color: var(--masks-v2-text-muted);
          cursor: pointer;
          font-size: 0.7rem;
          line-height: 1;
          transition: all var(--masks-v2-transition-speed) ease;

          i {
            display: flex;
            align-items: center;
            justify-content: center;
          }

          &:hover {
            background: var(--masks-v2-accent-color);
            color: white;
            border-color: var(--masks-v2-accent-color);
          }

          &.move-roll {
            background: var(--masks-v2-accent-color);
            border-color: var(--masks-v2-accent-color);
            color: white;

            &:hover {
              filter: brightness(1.15);
            }
          }

          &.move-delete:hover {
            background: var(--masks-danger-color);
            border-color: var(--masks-danger-color);
          }
        }
      }
    }

    &:hover .move-actions {
      opacity: 1;
    }

    /* Highlight moves with rolls */
    &.has-roll .move-icon {
      background: var(--masks-v2-accent-color);
      border-color: var(--masks-v2-accent-color);
      color: white;
    }

    .move-description {
      margin-top: 8px;
      margin-left: 32px; /* Align with move name */
      font-size: 0.85rem;
      color: var(--masks-v2-text-secondary);
      line-height: 1.5;

      /* Use grid for smooth height animation */
      display: grid;
      grid-template-rows: 1fr;
      transition: grid-template-rows 0.2s ease-out, opacity 0.2s ease-out;
      opacity: 1;

      > * {
        overflow: hidden;
      }

      &.collapsed {
        grid-template-rows: 0fr;
        opacity: 0;
      }
    }
  }
}

/* =========================================================================== */
/* PLAYBOOK TAB                                                                 */
/* =========================================================================== */

.masks-sheet-v2 .playbook-tab {
  .playbook-section {
    margin-bottom: 20px;

    &:last-child {
      margin-bottom: 0;
    }
  }

  /* Playbook Features Section (uses PbtA attribute renderer) */
  .playbook-section--features {
    .playbook-features {
      display: flex;
      flex-direction: column;
      gap: 12px;

      /* Style PbtA cell types within playbook features */
      .cell {
        margin-bottom: 0;
        padding: 12px;
        background: var(--masks-v2-input-bg);
        border: 1px solid var(--masks-v2-border-color);
        border-radius: var(--masks-v2-corner-radius);

        .cell__title {
          font-size: 0.8rem;
          font-weight: 600;
          text-transform: uppercase;
          letter-spacing: 0.05em;
          color: var(--masks-v2-text-secondary);
          margin-bottom: 8px;

          /* Remove the decorative before/after bars from original styling */
          &::before, &::after {
            display: none;
          }
        }

        .cell__description {
          font-size: 0.75rem;
          color: var(--masks-v2-text-muted);
          font-style: italic;
          margin-bottom: 8px;
        }

        /* LongText editors */
        .editor {
          min-height: 80px;

          .editor-content {
            background: var(--masks-v2-sidebar-bg);
            border: 1px solid var(--masks-v2-border-color);
            border-radius: var(--masks-v2-corner-radius);
            color: var(--masks-v2-text-primary);
            padding: 8px;
          }
        }

        /* ListMany checkboxes */
        .cell__checkboxes {
          list-style: none;
          padding: 0;
          margin: 0;

          label.flexrow {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 8px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--masks-v2-corner-radius);
            margin-bottom: 4px;
            color: var(--masks-v2-text-secondary);
            font-size: 0.85rem;

            input[type="checkbox"] {
              accent-color: var(--masks-v2-accent-color);
            }

            input[type="text"] {
              flex: 1;
              background: var(--masks-v2-sidebar-bg);
              border: 1px solid var(--masks-v2-border-color);
              border-radius: var(--masks-v2-corner-radius);
              color: var(--masks-v2-text-primary);
              padding: 4px 8px;
              font-size: 0.85rem;

              &:focus {
                outline: none;
                border-color: var(--masks-v2-accent-color);
              }
            }
          }
        }
      }
    }

    /* New custom playbook features list (filtered, no conditions) */
    .playbook-features-list {
      display: flex;
      flex-direction: column;
      gap: 16px;

      .playbook-feature {
        padding: 12px;
        background: var(--masks-v2-input-bg);
        border: 1px solid var(--masks-v2-border-color);
        border-radius: var(--masks-v2-corner-radius);

        .feature-label {
          display: block;
          font-size: 0.8rem;
          font-weight: 600;
          text-transform: uppercase;
          letter-spacing: 0.05em;
          color: var(--masks-v2-text-secondary);
          margin-bottom: 8px;
        }

        .feature-description {
          font-size: 0.75rem;
          color: var(--masks-v2-text-muted);
          font-style: italic;
          margin: 0 0 8px 0;
        }

        /* LongText editors - fix height */
        .editor {
          min-height: 120px;

          .editor-content {
            min-height: 100px;
            background: var(--masks-v2-sidebar-bg);
            border: 1px solid var(--masks-v2-border-color);
            border-radius: var(--masks-v2-corner-radius);
            color: var(--masks-v2-text-primary);
            padding: 8px;
          }
        }

        /* ListMany options */
        .feature-options {
          list-style: none;
          padding: 0;
          margin: 0;
          display: flex;
          flex-direction: column;
          gap: 4px;

          li {
            label {
              display: flex;
              align-items: center;
              gap: 8px;
              padding: 6px 8px;
              background: rgba(255, 255, 255, 0.03);
              border-radius: var(--masks-v2-corner-radius);
              color: var(--masks-v2-text-secondary);
              font-size: 0.85rem;
              cursor: pointer;

              &:hover {
                background: rgba(255, 255, 255, 0.06);
              }

              input[type="checkbox"] {
                accent-color: var(--masks-v2-accent-color);
                flex-shrink: 0;
              }

              /* Multiple checkboxes per option (e.g., The Scion, The Reformed) */
              .feature-checkboxes {
                display: flex;
                gap: 4px;
                flex-shrink: 0;

                input[type="checkbox"] {
                  margin: 0;
                }
              }

              input[type="text"] {
                flex: 1;
                background: var(--masks-v2-sidebar-bg);
                border: 1px solid var(--masks-v2-border-color);
                border-radius: var(--masks-v2-corner-radius);
                color: var(--masks-v2-text-primary);
                padding: 4px 8px;
                font-size: 0.85rem;

                &:focus {
                  outline: none;
                  border-color: var(--masks-v2-accent-color);
                }
              }
            }
          }
        }

        /* Text and Number inputs */
        input[type="text"],
        input[type="number"] {
          width: 100%;
          background: var(--masks-v2-sidebar-bg);
          border: 1px solid var(--masks-v2-border-color);
          border-radius: var(--masks-v2-corner-radius);
          color: var(--masks-v2-text-primary);
          padding: 8px;
          font-size: 0.9rem;

          &:focus {
            outline: none;
            border-color: var(--masks-v2-accent-color);
          }
        }

        /* Clock tracker (e.g., Doom Track) */
        .clock-tracker {
          display: flex;
          align-items: center;
          gap: 12px;

          .clock-pips {
            display: flex;
            gap: 6px;

            .clock-pip {
              width: 24px;
              height: 24px;
              border-radius: 50%;
              background: var(--masks-v2-sidebar-bg);
              border: 2px solid var(--masks-danger-color);
              cursor: pointer;
              transition: all var(--masks-v2-transition-speed) ease;

              &:hover {
                transform: scale(1.1);
                box-shadow: 0 0 8px var(--masks-danger-color);
              }

              &.filled {
                background: var(--masks-danger-color);
              }
            }
          }

          .clock-count {
            font-size: 0.85rem;
            color: var(--masks-v2-text-secondary);
          }
        }

        /* Number tracker (e.g., Burn, Fight the Fight) */
        .number-tracker {
          display: flex;
          align-items: center;
          gap: 8px;

          .tracker-btn {
            width: 28px;
            height: 28px;
            border-radius: var(--masks-v2-corner-radius);
            background: var(--masks-v2-sidebar-bg);
            border: 1px solid var(--masks-v2-border-color);
            color: var(--masks-v2-text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--masks-v2-transition-speed) ease;

            &:hover {
              background: var(--masks-v2-accent-color);
              color: var(--masks-v2-text-primary);
              border-color: var(--masks-v2-accent-color);
            }

            i {
              font-size: 0.75rem;
            }
          }

          .tracker-value {
            width: 50px;
            text-align: center;
            background: var(--masks-v2-sidebar-bg);
            border: 1px solid var(--masks-v2-border-color);
            border-radius: var(--masks-v2-corner-radius);
            color: var(--masks-v2-text-primary);
            padding: 6px;
            font-size: 1rem;
            font-weight: 600;

            &:focus {
              outline: none;
              border-color: var(--masks-v2-accent-color);
            }
          }
        }
      }
    }
  }

  .section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 8px;

    .section-title {
      margin-bottom: 0;
      padding-bottom: 0;
      border-bottom: none;
    }

    .moment-unlock-toggle {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.8rem;
      color: var(--masks-v2-text-muted);
      cursor: pointer;

      input {
        accent-color: var(--masks-v2-accent-color);
      }
    }
  }

  .advancements-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .advancement-item {
    .advancement-label {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      background: var(--masks-v2-input-bg);
      border: 1px solid var(--masks-v2-border-color);
      border-radius: var(--masks-v2-corner-radius);
      cursor: pointer;
      transition: all var(--masks-v2-transition-speed) ease;

      &:hover {
        background: rgba(255, 255, 255, 0.05);
      }

      .advancement-checkboxes {
        display: flex;
        gap: 4px;
      }

      .advancement-check {
        accent-color: var(--masks-v2-accent-color);
      }

      .advancement-text {
        flex: 1;
        font-size: 0.85rem;
        color: var(--masks-v2-text-secondary);
      }

      .advancement-custom-text {
        flex: 1;
        background: transparent;
        border: none;
        border-bottom: 1px solid var(--masks-v2-border-color);
        color: var(--masks-v2-text-primary);
        font-size: 0.85rem;
        padding: 2px 0;

        &:focus {
          outline: none;
          border-bottom-color: var(--masks-v2-accent-color);
        }
      }
    }
  }

  /* Moment of Truth Section - Fix styling */
  .playbook-section--moment {
    padding: 12px;
    background: var(--masks-v2-input-bg);
    border: 1px solid var(--masks-v2-border-color);
    border-radius: var(--masks-v2-corner-radius);

    .editor {
      min-height: 100px;

      .editor-content {
        background: var(--masks-v2-sidebar-bg);
        border: 1px solid var(--masks-v2-border-color);
        border-radius: var(--masks-v2-corner-radius);
        color: var(--masks-v2-text-primary);
        padding: 8px;
        min-height: 80px;
      }
    }
  }

  /* Later Advances Section */
  .playbook-section--later-advances {
    padding: 12px;
    background: var(--masks-v2-input-bg);
    border: 1px solid var(--masks-v2-border-color);
    border-radius: var(--masks-v2-corner-radius);
    border-left: 3px solid var(--masks-v2-accent-color);
  }

  /* PbtA Clock Pattern Styling (used by Doom Track, etc.) */
  .cell__clock {
    display: flex;
    gap: 6px;
    align-items: center;

    .attr-clock {
      appearance: none;
      -webkit-appearance: none;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: var(--masks-v2-sidebar-bg);
      border: 2px solid var(--masks-danger-color);
      cursor: pointer;
      transition: all var(--masks-v2-transition-speed) ease;
      margin: 0;

      &:hover {
        transform: scale(1.1);
        box-shadow: 0 0 8px var(--masks-danger-color);
      }

      &:checked {
        background: var(--masks-danger-color);
      }
    }
  }

  .clock-count {
    font-size: 0.85rem;
    color: var(--masks-v2-text-secondary);
    margin-left: 8px;
  }

  /* PbtA ListMany Pattern Styling (used by Advancements, features) */
  .cell__checkboxes {
    list-style: none;
    padding: 0;
    margin: 0;

    label.flexrow {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 8px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: var(--masks-v2-corner-radius);
      margin-bottom: 4px;
      color: var(--masks-v2-text-secondary);
      font-size: 0.85rem;
      cursor: pointer;

      &:hover {
        background: rgba(255, 255, 255, 0.06);
      }

      input[type="checkbox"].attr-list {
        accent-color: var(--masks-v2-accent-color);
        flex-shrink: 0;
        margin: 0;
      }

      input[type="text"].input-title {
        flex: 1;
        background: var(--masks-v2-sidebar-bg);
        border: 1px solid var(--masks-v2-border-color);
        border-radius: var(--masks-v2-corner-radius);
        color: var(--masks-v2-text-primary);
        padding: 4px 8px;
        font-size: 0.85rem;

        &:focus {
          outline: none;
          border-color: var(--masks-v2-accent-color);
        }
      }
    }
  }
}

/* =========================================================================== */
/* NPC SHEET - Keep existing styling                                           */
/* =========================================================================== */

.masks-sheet-v2 .npc-sheet {
  /* NPC sheets use original styling */
}