{{!-- templates/turncards.hbs --}}
{{!-- Team Turn Cards HUD --}}

<div class="turncards-row" data-team-size="{{teamSize}}" data-max-turns="{{maxTurns}}">
    {{!-- Team Pool Card --}}
    {{#if showTeamCard}}
    <div class="turncard-wrapper turncard-wrapper--team">
        <article class="turncard turncard--team" role="group" aria-label="Team pool" data-combatant-id="team">
            <div class="turncard__inner">
                <div class="turncard__portrait turncard__portrait--team">
                    <div class="turncard__team">
                        <div class="turncard__team-label">Team</div>
                        <div class="turncard__team-value" aria-live="polite">{{team}}</div>

                        <div class="turncard__team-controls">
                            <button type="button" class="turncard__team-btn" data-action="team-minus" {{#unless
                                teamCanEdit}}disabled{{/unless}} data-tooltip="Spend Team (Shift: 5)"
                                aria-label="Spend Team">
                                <i class="fa-solid fa-minus"></i>
                            </button>

                            <button type="button" class="turncard__team-btn" data-action="team-reset" {{#unless
                                teamCanEdit}}disabled{{/unless}} data-tooltip="Reset Team" aria-label="Reset Team">
                                <i class="fa-solid fa-rotate-left"></i>
                            </button>

                            <button type="button" class="turncard__team-btn" data-action="team-plus" {{#unless
                                teamCanEdit}}disabled{{/unless}} data-tooltip="Add Team (Shift: 5)"
                                aria-label="Add Team">
                                <i class="fa-solid fa-plus"></i>
                            </button>
                        </div>
                    </div>

                    {{!-- Action button overlay (appears on hover) --}}
                    {{#if isGM}}
                    <button type="button" class="turncard__action" data-action="team-action"
                        aria-label="GM Turn: Advance all cooldowns" data-tooltip="GM/NPC Turn: Advance cooldowns">
                        <span class="turncard__action-label">Action</span>
                    </button>
                    {{/if}}
                </div>

                <footer class="turncard__nameplate turncard__nameplate--team">
                    <div class="turncard__name">Pool</div>
                </footer>
            </div>
        </article>
    </div>
    {{/if}}

    {{!-- Character Cards --}}
    {{#each cards as |card|}}
    <div class="turncard-wrapper" data-combatant-id="{{card.combatantId}}">
        <article
            class="turncard turncard--state-{{card.status}} {{#if card.onCooldown}}is-cooldown{{/if}} {{#if card.downed}}is-downed{{/if}}"
            data-combatant-id="{{card.combatantId}}" data-actor-id="{{card.actorId}}" role="button" tabindex="0"
            aria-label="{{card.ariaLabel}}" {{#if card.downedId}}aria-describedby="{{card.downedId}}" {{/if}}>
            <div class="turncard__inner">

                <div class="turncard__portrait">
                    <img src="{{card.img}}" alt="{{card.name}}" loading="lazy" />

                    {{!-- Cooldown bar (drains right-to-left) --}}
                    {{#if card.showStatusBar}}
                    <div class="turncard__cooldown" data-tooltip="{{card.statusTooltip}}">
                        <div class="turncard__cooldown-bar" style="--cooldown-frac: {{card.cooldownFrac}};"></div>
                        <span class="turncard__cooldown-label">Busy</span>
                    </div>
                    {{/if}}

                    {{!-- Action button overlay --}}
                    {{#if card.canMarkTurn}}
                    <button type="button" class="turncard__action {{#if card.actionDisabled}}is-disabled{{/if}}"
                        data-action="card-action" data-combatant-id="{{card.combatantId}}"
                        aria-label="{{card.actionAria}}" data-tooltip="{{card.actionAria}}" {{#if
                        card.actionDisabled}}disabled{{/if}}>
                        <span class="turncard__action-label">Action</span>
                    </button>
                    {{/if}}

                    {{!-- Bottom-left: Shift Labels (circle) --}}
                    <button type="button" class="turncard__shift {{#unless card.canShiftLabels}}is-disabled{{/unless}}"
                        data-action="shift-labels" data-actor-id="{{card.actorId}}"
                        aria-label="Shift Labels for {{card.name}}" data-tooltip="Shift Labels" {{#unless
                        card.canShiftLabels}}disabled{{/unless}}>
                        <i class="fa-solid fa-circle"></i>
                    </button>

                    {{!-- Above Shift Labels: Forward/Bonus button --}}
                    {{#if card.showBonus}}
                    <button type="button"
                        class="turncard__forward {{#if card.hasBonus}}has-bonus{{/if}} {{#unless card.canEditForward}}is-readonly{{/unless}}"
                        data-action="forward" data-actor-id="{{card.actorId}}" aria-label="{{card.forwardTooltip}}"
                        data-tooltip="{{card.forwardTooltip}}" {{#unless card.canEditForward}}disabled{{/unless}}>
                        {{#if card.hasBonus}}
                        <span class="turncard__forward-value">+{{card.effectiveBonus}}</span>
                        {{else}}
                        <i class="fa-solid fa-plus"></i>
                        {{/if}}
                    </button>
                    {{/if}}

                    {{!-- Bottom-right: Potential (star) --}}
                    <button type="button"
                        class="turncard__potential {{#unless card.canEditPotential}}is-disabled{{/unless}}"
                        data-action="potential" data-actor-id="{{card.actorId}}" {{#unless
                        card.canEditPotential}}disabled{{/unless}}
                        aria-label="Potential: {{card.potential}} of {{card.potentialMax}} (Click +1, Right-click -1)"
                        data-tooltip="Potential: {{card.potential}}/{{card.potentialMax}}"
                        style="--potential-fill: {{card.potentialPct}};">
                        <i class="fa-solid fa-star"></i>
                    </button>
                </div>

                <footer class="turncard__nameplate">
                    <div class="turncard__name" title="{{card.name}}">
                        {{card.name}}
                    </div>
                </footer>

                {{#if card.downed}}
                <div class="turncard__downed" id="{{card.downedId}}" role="status" aria-label="Downed">
                    <div class="turncard__downed-label">DOWNED</div>
                </div>
                {{/if}}
            </div>
        </article>
    </div>
    {{/each}}
</div>