{{!-- Team Turn Cards HUD --}}

<div class="turncards-row" data-team-size="{{teamSize}}" data-max-turns="{{maxTurns}}">
    {{!-- Team Pool Card --}}
    {{#if showTeamCard}}
    <div class="turncard-wrapper turncard-wrapper--team">
        <article class="turncard turncard--gm turncard--state-team" role="group" aria-label="Team pool">
            <div class="turncard__inner">
                <div class="turncard__portrait turncard__portrait--team">
                    {{#if isGM}}
                    <button type="button" class="turncard__gm-action ui-control plain" data-action="gm-turn"
                        aria-label="Advance cooldowns for GM and NPC actions"
                        data-tooltip="GM Turn: Advance all cooldowns">
                        <i class="fa-solid fa-play"></i>
                    </button>
                    {{/if}}

                    <div class="turncard__team">
                        <div class="turncard__team-label">Team</div>
                        <div class="turncard__team-value" aria-live="polite">{{team}}</div>

                        <div class="turncard__team-controls">
                            <button type="button" class="turncard__team-btn ui-control plain" data-action="team-minus"
                                {{#unless teamCanEdit}}disabled{{/unless}} data-tooltip="Spend 1 Team (Shift: 5)"
                                aria-label="Spend Team">
                                <i class="fa-solid fa-minus"></i>
                            </button>

                            <button type="button" class="turncard__team-btn ui-control plain" data-action="team-plus"
                                {{#unless teamCanEdit}}disabled{{/unless}} data-tooltip="Add 1 Team (Shift: 5)"
                                aria-label="Add Team">
                                <i class="fa-solid fa-plus"></i>
                            </button>

                            <button type="button" class="turncard__team-btn ui-control plain" data-action="team-reset"
                                {{#unless teamCanEdit}}disabled{{/unless}} data-tooltip="Reset Team to 0"
                                aria-label="Reset Team">
                                <i class="fa-solid fa-rotate-left"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <footer class="turncard__nameplate turncard__nameplate--team">
                    <div class="turncard__name">Team Pool</div>
                </footer>
            </div>
        </article>
    </div>
    {{/if}}

    {{!-- Character Cards --}}
    {{#each cards as |card|}}
    <div class="turncard-wrapper" data-combatant-id="{{card.combatantId}}">
        <article
            class="turncard turncard--state-{{card.status}} {{#if card.onCooldown}}is-cooldown{{/if}} {{#if card.downed}}is-downed{{/if}}"
            data-combatant-id="{{card.combatantId}}" data-actor-id="{{card.actorId}}" role="button" tabindex="0"
            aria-label="{{card.ariaLabel}}" {{#if card.downedId}}aria-describedby="{{card.downedId}}" {{/if}}>
            <div class="turncard__inner">

                <div class="turncard__portrait">
                    <img src="{{card.img}}" alt="{{card.name}}" loading="lazy" />

                    {{#if card.showStatusBar}}
                    <div class="turncard__status">
                        <div class="turncard__status-track"></div>
                        {{#if card.showCooldownBar}}
                        <div class="turncard__cooldown-fill"
                            style="--masks-turncards-cooldown-frac:{{card.cooldownFrac}};">
                        </div>
                        {{/if}}
                        <span class="turncard__status-label">{{card.statusLabel}}</span>
                    </div>
                    {{/if}}

                    {{!-- Action OR Aid overlay --}}
                    <button type="button"
                        class="turncard__action ui-control {{#if card.actionDisabled}}turncard__action--disabled{{/if}}"
                        data-action="{{card.actionAction}}" data-actor-id="{{card.actorId}}"
                        aria-label="{{card.actionAria}}" data-tooltip="{{card.actionAria}}" {{#if
                        card.actionDisabled}}disabled{{/if}}>
                        <span class="turncard__action-label">{{card.actionLabel}}</span>
                    </button>

                    {{!-- Shift Labels (pentagon) --}}
                    <button type="button"
                        class="turncard__shift ui-control plain {{#unless card.canShiftLabels}}turncard__shift--disabled{{/unless}}"
                        data-action="shift-labels" data-actor-id="{{card.actorId}}"
                        aria-label="Shift Labels for {{card.name}}" data-tooltip="Shift Labels" {{#unless
                        card.canShiftLabels}}disabled{{/unless}}>
                        <i class="fa-solid fa-circle"></i>
                    </button>

                    {{!-- Potential (star) --}}
                    <button type="button"
                        class="turncard__potential ui-control plain {{#unless card.canEditPotential}}turncard__potential--disabled{{/unless}}"
                        data-action="potential" {{#unless card.canEditPotential}}disabled{{/unless}}
                        aria-label="Potential: {{card.potential}} of {{card.potentialMax}} (Click +1, Right-click -1)"
                        data-tooltip="Potential: {{card.potential}}/{{card.potentialMax}}"
                        style="--masks-turncards-potential-fill:{{card.potentialPct}};">
                        <i class="fa-solid fa-star"></i>
                    </button>

                    {{!-- Aid/Team Forward button (separate from main action) --}}
                    <button type="button"
                        class="turncard__assist ui-control plain {{#unless card.canTeamForward}}turncard__assist--disabled{{/unless}}"
                        data-action="team-forward" data-actor-id="{{card.actorId}}"
                        aria-label="Spend 1 Team to give {{card.name}} +1 Forward"
                        data-tooltip="Aid: +1 Forward (costs 1 Team)" {{#unless
                        card.canTeamForward}}disabled{{/unless}}>
                        <i class="fa-solid fa-up"></i>
                    </button>
                </div>

                <footer class="turncard__nameplate">
                    <div class="turncard__name" title="{{card.name}}">
                        {{card.name}}
                    </div>
                </footer>

                {{#if card.downed}}
                <div class="turncard__downed" id="{{card.downedId}}" role="status" aria-label="Downed">
                    <div class="turncard__downed-label">DOWNED</div>
                </div>
                {{/if}}
            </div>
        </article>
    </div>
    {{/each}}
</div>