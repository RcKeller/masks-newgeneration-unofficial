{{!-- Playbook Tab: Playbook-specific attributes + Advancement --}}
<div class="tab playbook-tab" data-group="primary" data-tab="playbook">
	<section class="sheet-tab playbook-content">

		{{!-- Playbook-Specific Attributes --}}
		{{#if playbookAttributes}}
		<div class="playbook-attributes-section">
			{{#each playbookAttributes as |attr key|}}
			<div class="playbook-attr cell--{{key}} cell--{{attr.type}}">
				{{#if attr.customLabel}}
				<input type="text" class="input--cell-title" name="system.attributes.{{key}}.userLabel" value="{{#if attr.userLabel}}{{attr.userLabel}}{{else}}{{attr.label}}{{/if}}">
				{{else}}
				<label class="playbook-attr-title">{{attr.label}}</label>
				{{/if}}
				{{#if attr.description}}<p class="playbook-attr-description">{{attr.description}}</p>{{/if}}

				{{!-- LongText --}}
				{{#if (eq attr.type "LongText")}}
				{{editor attr.enriched target=attr.attrName button=true owner=../owner editable=../editable}}

				{{!-- Checkbox --}}
				{{else if (eq attr.type "Checkbox")}}
				{{#if attr.checkboxLabel}}<label class="checkbox-label">{{/if}}
				<input type="checkbox" name="system.attributes.{{key}}.value" {{checked attr.value}}/>
				{{#if attr.checkboxLabel}}{{attr.checkboxLabel}}</label>{{/if}}

				{{!-- Number --}}
				{{else if (eq attr.type "Number")}}
				<input type="text" class="playbook-number-input" name="system.attributes.{{key}}.value" value="{{attr.value}}" data-dtype="Number"/>

				{{!-- Clock --}}
				{{else if (eq attr.type "Clock")}}
				<div class="playbook-clock">
					{{#times attr.max}}
					<input type="checkbox" class="attr-clock" data-name="system.attributes.{{key}}" data-step="{{@index}}" {{checked (gt attr.value @index)}}>
					{{/times}}
				</div>

				{{!-- ListMany --}}
				{{else if (eq attr.type "ListMany")}}
				<ul class="playbook-list-many">
					{{#each attr.options as |option optionKey|}}
					<label class="playbook-list-item"
						{{#if option.tooltip}}
						data-tooltip="{{option.tooltip}}"
						data-tooltip-direction="UP"
						{{/if}}>
						{{#if option.values}}
						{{#each option.values as |suboption suboptionKey|}}
						<input type="checkbox" class="attr-list" name="system.attributes.{{key}}.options.{{optionKey}}.values.{{suboptionKey}}.value" {{checked suboption.value}}/>
						{{/each}}
						{{else}}
						<input type="checkbox" class="attr-list" name="system.attributes.{{key}}.options.{{optionKey}}.value" {{checked option.value}}/>
						{{/if}}
						{{#if (eq option.label "[Text]")}}
						<input type="text" class="input input-title playbook-text-input" name="system.attributes.{{key}}.options.{{optionKey}}.userLabel" value="{{option.userLabel}}">
						{{else}}
						<span class="option-label">{{option.label}}</span>
						{{/if}}
					</label>
					{{/each}}
				</ul>

				{{!-- Track --}}
				{{else if (eq attr.type "Track")}}
				<div class="playbook-track">
					{{#each attr.steps as |step stepKey|}}
					{{#if step.isValue}}
					<span class="track-value" role="checkbox" data-name="system.attributes.{{key}}" data-value="{{step.value}}" aria-checked="{{step.checked}}">{{step.label}}</span>
					{{else}}
					<input class="track-step" type="checkbox" data-name="system.attributes.{{key}}" data-step="{{step.step}}" data-value="{{step.value}}" {{checked step.checked}}>
					{{/if}}
					{{/each}}
					{{#if (and attr.positive.label attr.negative.label)}}
					<span class="track-label-negative">{{attr.negative.label}}</span>
					<span class="track-label-positive">{{attr.positive.label}}</span>
					{{/if}}
				</div>

				{{!-- Fallback Text --}}
				{{else}}
				<input type="text" class="input playbook-text-input" name="system.attributes.{{key}}.value" value="{{attr.value}}"/>
				{{/if}}
			</div>
			{{/each}}
		</div>
		{{/if}}

		{{!-- Moment of Truth --}}
		{{#with system.attributes.momentOfTruth}}
		<div class="playbook-section moment-of-truth-section">
			<label class="playbook-section-title">
				{{label}}
				<span class="moment-unlock">
					{{../system.attributes.momentUnlocked.checkboxLabel}}
					<input type="checkbox" name="system.attributes.momentUnlocked.value" {{checked ../system.attributes.momentUnlocked.value}}/>
				</span>
			</label>
			{{#if description}}<p class="playbook-description">{{description}}</p>{{/if}}
			{{editor value target="system.attributes.momentOfTruth.value" button=true owner=../owner editable=../editable}}
		</div>
		{{/with}}

		{{!-- Advancements --}}
		{{#with system.attributes.advancements}}
		<div class="playbook-section advancements-section">
			<label class="playbook-section-title">{{label}}</label>
			{{#if description}}<p class="playbook-description">{{description}}</p>{{/if}}
			<ul class="advancements-list">
				{{#each options as |option optionKey|}}
				<label class="advancement-item"
					{{#if option.tooltip}}
					data-tooltip="{{option.tooltip}}"
					data-tooltip-direction="UP"
					{{/if}}>
					{{#if option.values}}
					{{#each option.values as |suboption suboptionKey|}}
					<input type="checkbox" class="attr-list" name="system.attributes.advancements.options.{{optionKey}}.values.{{suboptionKey}}.value" {{checked suboption.value}}/>
					{{/each}}
					{{else}}
					<input type="checkbox" class="attr-list" name="system.attributes.advancements.options.{{optionKey}}.value" {{checked option.value}}/>
					{{/if}}
					{{#if (eq option.label "[Text]")}}
					<input type="text" class="input input-title" name="system.attributes.advancements.options.{{optionKey}}.userLabel" value="{{option.userLabel}}">
					{{else}}
					<span class="advancement-label">{{option.label}}</span>
					{{/if}}
				</label>
				{{/each}}
			</ul>
		</div>
		{{/with}}

		{{!-- Later Advances --}}
		{{#with system.attributes.laterAdvances}}
		<div class="playbook-section later-advances-section">
			<label class="playbook-section-title">{{label}}</label>
			{{#if description}}<p class="playbook-description">{{description}}</p>{{/if}}
			<ul class="advancements-list">
				{{#each options as |option optionKey|}}
				<label class="advancement-item"
					{{#if option.tooltip}}
					data-tooltip="{{option.tooltip}}"
					data-tooltip-direction="UP"
					{{/if}}>
					{{#if option.values}}
					{{#each option.values as |suboption suboptionKey|}}
					<input type="checkbox" class="attr-list" name="system.attributes.laterAdvances.options.{{optionKey}}.values.{{suboptionKey}}.value" {{checked suboption.value}}/>
					{{/each}}
					{{else}}
					<input type="checkbox" class="attr-list" name="system.attributes.laterAdvances.options.{{optionKey}}.value" {{checked option.value}}/>
					{{/if}}
					{{#if (eq option.label "[Text]")}}
					<input type="text" class="input input-title" name="system.attributes.laterAdvances.options.{{optionKey}}.userLabel" value="{{option.userLabel}}">
					{{else}}
					<span class="advancement-label">{{option.label}}</span>
					{{/if}}
				</label>
				{{/each}}
			</ul>
		</div>
		{{/with}}

	</section>
</div>
